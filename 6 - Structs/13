/*13. Peca ao usuario para digitar seus dados pessoais (Nome, Enderec¸o, Data de Nasci-
mento, Cidade, CEP, email), verifique se as informac¸oes de Data de Nascimento, CEP 
e email fazem sentido, e mostre ao usuario as informacoes, se estao todas corretas, ou 
mostre que alguma informacao estava errada.  */

#include <stdio.h>
#include <string.h>

typedef struct {
    char nome[50];
    char endereco[50];
    char dataNascimento[12];
    char cidade[50];
    char cep[10];
    char email[50];
}Pessoa;
int verificarNome(Pessoa pessoa);
int verificarEndereco();
int verificarDataNascimento(Pessoa pessoa);
int verificarCidade();
int verificarCep(Pessoa pessoa);
int verificarEmail(Pessoa pessoa);


int main () {
    Pessoa pessoa;

    printf ("Informe o nome : ");
    fgets (pessoa.nome, sizeof(pessoa.nome), stdin);
    pessoa.nome[strcspn(pessoa.nome, "\n")] = '\0';
    
    if (!verificarNome(pessoa)){
        printf ("Nome Inválido !");
        return 1;
    }


    printf ("Informe o endereço : ");
    fgets (pessoa.endereco, sizeof(pessoa.endereco), stdin);
    pessoa.endereco[strcspn(pessoa.endereco, "\n")] = '\0';

    if (!verificarEndereco()){
        printf ("Endereco Inválido !");
        return 1;
    }

    printf ("Informe a data de nascimento :\ndd/mm/aaaa : ");
    fgets (pessoa.dataNascimento, sizeof(pessoa.dataNascimento), stdin);
    pessoa.dataNascimento[strcspn(pessoa.dataNascimento, "\n")] = '\0';

    if (!verificarDataNascimento(pessoa)){
        printf ("Data Inválida !");
        return 1;
    }

    printf ("Informe a cidade : ");
    fgets (pessoa.cidade, sizeof(pessoa.cidade), stdin);
    pessoa.cidade[strcspn(pessoa.cidade, "\n")] = '\0';

    if (!verificarCidade()){
        printf ("Cidade Inválida !");
        return 1;
    }

    printf ("Informe o CEP : ");
    fgets (pessoa.cep, sizeof(pessoa.cep), stdin);
    pessoa.cep[strcspn(pessoa.cep, "\n")] = '\0';

    if (!verificarCep(pessoa)){
        printf ("CEP Inválido !");
        return 1;
    }

    printf ("Informe o email : ");
    fgets (pessoa.email, sizeof(pessoa.email), stdin);
    pessoa.email[strcspn(pessoa.email, "\n")] = '\0';


    if (!verificarEmail(pessoa)){
        printf ("Email Inválido !");
        return 1;
    }

    printf ("\nNome : %s\n", pessoa.nome);
    printf ("Endereço : %s\n", pessoa.endereco);
    printf ("Data de Nascimento : %s\n", pessoa.dataNascimento);
    printf ("Cidade : %s\n", pessoa.cidade);
    printf ("Cep : %s\n", pessoa.cep);
    printf ("Email : %s\n", pessoa.email);
    return 0;
}

int verificarNome(Pessoa pessoa){
    int espaco = 0;

    for (int i=0; i<strlen(pessoa.nome) - 1; i++){
        if (pessoa.nome[i] == ' '){
            if (pessoa.nome[i+1] == ' '){
                printf ("Erro no nome, há dois espaços consecutivos\n");
                return 0;
            }
            if (pessoa.nome[i+1] == '\0'){
                printf ("Erro no nome, o último caractere é um espaço\n");
                return 0;
            }
            if (pessoa.nome[i+1] < 65 || pessoa.nome[i+1] > 90){
                printf ("Sobrenome está sem a letra maiúscula no início !\n");
                return 0;
            }
            espaco++;
        }
    }
    if (!espaco){
        printf ("Cadê o Sobrenome ?\n");
        return 0;
    }
    if (pessoa.nome[0] < 65 || pessoa.nome[0] > 90){
        printf ("Não há caractere maiúsculo no Nome !\n");
        return 0;
    }
}

int verificarEndereco(){
    int correto;
    printf ("Tem certez que eatá correto ?\nSim - 1\nNão - 0\n");
    scanf ("%d", &correto);

    if (correto){
        getchar();
        return 1;
    }else return 0;
}

int verificarDataNascimento(Pessoa pessoa){
    int dia, mes, ano;
    sscanf(pessoa.dataNascimento, "%d/%d/%d", &dia, &mes, &ano);

    if (pessoa.dataNascimento[2] != '/' || pessoa.dataNascimento[5] != '/'){
        printf ("Erro ao utilizar o '/' \n");
        return 0;
    }
    if (pessoa.dataNascimento[10] != '\0'){
        printf ("Tamanho errado !\n");
        return 0;
    }
    if (mes >= 1 && mes <= 12) {
        if (mes == 1 || mes == 3 || mes == 5 || mes == 7 || mes == 8 || mes == 10 || mes == 12) {
            if (dia < 1 || dia > 31) {
                return 0;
            }
        }
        else if (mes == 4 || mes == 6 || mes == 9 || mes == 11) {
            if (dia < 1 || dia > 30) {
                return 0;
            }
        }
        else if (mes == 2) {
            if (dia < 1 || dia > 29) {
                return 0;
            }
        }
    }
    if (ano > 2025){
        return 0;
    }  
    return 1;
}

int verificarCidade(){
    int checar;
    printf ("Essa cidade existe mesmo ?\nSim - 1, Não - 0");
    scanf ("%d", &checar);
    if (checar){
        getchar();
        return 1;
    }else return 0;
}

int verificarCep(Pessoa pessoa){
    int tmn = strlen(pessoa.cep);

    if (pessoa.cep[5] == '-' && tmn == 9){
        getchar();
        return 1;
    }else if (pessoa.cep[5] != '-' && tmn == 8){
        return 1;
    }else return 0;    
}

int verificarEmail(Pessoa pessoa){
    char *result = strstr(pessoa.email, "@gmail.com");
    
    if (result){
        return 1;
    }
    else return 0;
}
